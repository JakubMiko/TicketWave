<div class="container mt-4">
  <div class="notification is-success">
    <h1 class="title is-3">Zakup potwierdzony!</h1>
    <p>Dziękujemy za zakup biletów. Poniżej znajdziesz szczegóły zamówienia.</p>

    <% if current_user && current_user.orders.count == 1 && current_user.orders.first.id == order.id %>
    <!-- This is a new user who just registered with this purchase -->
    <div class="mt-3 notification is-info">
      <p class="has-text-weight-bold">Twoje konto zostało utworzone!</p>
      <p>Na podstawie podanych danych utworzyliśmy dla Ciebie konto użytkownika.
      Możesz teraz przeglądać swoje bilety i historię zamówień w <a href="<%= users_dashboard_path %>" class="has-text-weight-bold">Panelu Użytkownika</a>.</p>
    </div>
    <% end %>
  </div>

  <div class="box">
    <h2 class="title is-4">Szczegóły zamówienia #<%= order.id %></h2>

    <div class="content">
      <p><strong>Wydarzenie:</strong> <%= order.event.name %></p>
      <p><strong>Data wydarzenia:</strong> <%= order.event.date.strftime("%d.%m.%Y, %H:%M") %></p>
      <p><strong>Miejsce:</strong> <%= order.event.place %></p>
      <p><strong>Ilość biletów:</strong> <%= order.quantity %></p>
      <p><strong>Cena za bilet:</strong> <%= number_to_currency(order.ticket_batch.price, unit: "zł", format: "%n %u") %></p>
      <p><strong>Łączna kwota:</strong> <%= number_to_currency(order.total_price, unit: "zł", format: "%n %u") %></p>
      <p><strong>Status:</strong> <span class="tag is-success">Zakupione</span></p>
    </div>

    <div class="notification is-warning">
      <h3 class="title is-5">Informacje o płatności</h3>
      <p>Aby dokończyć proces zakupu, prosimy o wykonanie przelewu na następujące dane:</p>
      <p><strong>Nazwa odbiorcy:</strong> TicketWave Sp. z o.o.</p>
      <p><strong>Numer konta:</strong> 25 1090 1056 0000 0001 3578 9024</p>
      <p><strong>Tytułem:</strong> Zamówienie #<%= order.id %> - <%= order.event.name %></p>
      <p><strong>Kwota:</strong> <%= number_to_currency(order.total_price, unit: "zł", format: "%n %u") %></p>
      <p>Po zaksięgowaniu wpłaty, status Twojego zamówienia zostanie automatycznie zaktualizowany.</p>
    </div>

    <hr>

    <h3 class="title is-5">Twoje bilety</h3>

    <table class="table is-fullwidth">
      <thead>
        <tr>
          <th>Numer biletu</th>
          <th>Cena</th>
        </tr>
      </thead>
      <tbody>
        <% order.tickets.each do |ticket| %>
          <tr>
            <td><%= ticket.ticket_number %></td>
            <td><%= number_to_currency(ticket.price, unit: "zł", format: "%n %u") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="buttons">
      <% if user_signed_in? || admin_signed_in? %>
        <%= link_to "Moje zamówienia", orders_path, class: "button is-primary" %>
      <% else %>
        <div class="notification is-info">
          <p>Aby zobaczyć swoje bilety i zamówienia w przyszłości, <a href="<%= new_user_session_path %>" class="has-text-weight-bold">zaloguj się</a> używając podanego adresu email i hasła.</p>
        </div>
      <% end %>
      <%= link_to "Powrót do wydarzeń", events_path, class: "button is-light" %>
    </div>
  </div>
</div>
