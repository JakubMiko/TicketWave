<div id="ticket_batches_list">
  <% if event.ticket_batches.any? %>
    <div class="box mt-4">
      <h2 class="title is-4"><%= user_signed_in? && current_user.role == "admin" ? "Pule biletów" : "Dostępne bilety" %></h2>
      <div class="table-container">
        <table class="table is-fullwidth is-striped">
          <thead>
            <tr>
              <th>Liczba biletów</th>
              <th>Cena</th>
              <th>Początek sprzedaży</th>
              <th>Koniec sprzedaży</th>
              <th>Status</th>
              <th>Akcje</th>
            </tr>
          </thead>
          <tbody>
            <% event.ticket_batches.each do |batch| %>
              <tr>
                <td><%= batch.available_tickets %></td>
                <td><%= number_to_currency(batch.price, unit: "PLN", format: "%n %u") %></td>
                <td><%= batch.sale_start&.strftime("%d-%m-%Y %H:%M") %></td>
                <td><%= batch.sale_end&.strftime("%d-%m-%Y %H:%M") %></td>
                <td>
                  <% current_time = Time.current %>
                  <% if batch.available_tickets <= 0 %>
                    <span class="tag is-danger">Wyprzedane</span>
                  <% elsif batch.sale_start > current_time %>
                    <span class="tag is-warning">Oczekujące</span>
                  <% elsif batch.sale_end < current_time %>
                    <span class="tag is-light">Zakończone</span>
                  <% else %>
                    <span class="tag is-success">Aktywne</span>
                  <% end %>
                </td>
                <td>
                  <% if user_signed_in? && current_user.role == "admin" %>
                    <%= link_to "Edytuj", edit_event_ticket_batch_path(event, batch),
                        class: "button is-small is-warning",
                        data: { turbo_frame: "modal_frame" } %>

                    <%= button_to "Usuń",
                        event_ticket_batch_path(event, batch),
                        method: :delete,
                        form: { data: { turbo_confirm: "Czy na pewno chcesz usunąć tę pulę biletów?" } },
                        class: "button is-small is-danger" %>
                  <% else %>
                    <% if batch.available_tickets > 0 && batch.sale_start <= current_time && batch.sale_end >= current_time %>
                      <%= link_to "Kup", new_ticket_batch_order_path(event_id: event.id, ticket_batch_id: batch.id), class: "button is-primary" %>
                    <% elsif batch.available_tickets <= 0 %>
                      <span class="has-text-danger">Brak biletów</span>
                    <% elsif batch.sale_start > current_time %>
                      <span class="has-text-warning">Sprzedaż rozpocznie się <%= batch.sale_start.strftime("%d.%m.%Y") %></span>
                    <% elsif batch.sale_end < current_time %>
                      <span class="has-text-danger">Sprzedaż zakończona</span>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <% if user_signed_in? && current_user.role == "admin" %>
        <div class="buttons mt-4">
          <%= link_to "Dodaj pulę biletów", new_event_ticket_batch_path(event), class: "button is-primary" %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="notification is-info mt-4">
      <% if user_signed_in? && current_user.role == "admin" %>
        Brak zdefiniowanych pul biletów dla tego wydarzenia.
        <div class="buttons mt-2">
          <%= link_to "Dodaj pulę biletów", new_event_ticket_batch_path(event), class: "button is-primary" %>
        </div>
      <% else %>
        Brak dostępnych biletów dla tego wydarzenia.
      <% end %>
    </div>
  <% end %>
</div>
