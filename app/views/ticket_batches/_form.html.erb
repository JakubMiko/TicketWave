<%= form_with model: [event, ticket_batch],
              local: false,
              data: {
                turbo_frame: "modal_frame"
                # Removed: action: "turbo:submit-end->modal#close"
              } do |form| %>
  <% if defined?(validation_errors) && validation_errors.any? %>
    <div class="notification is-danger">
      <button class="delete" aria-label="close"></button>
      <h2 class="subtitle">Nie można zapisać puli biletów:</h2>
      <ul>
        <% validation_errors.each do |key, messages| %>
          <% if key == :base %>
            <% messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          <% else %>
            <% messages.each do |msg| %>
              <li><%= key.to_s.humanize %> <%= msg %></li>
            <% end %>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :available_tickets, "Liczba dostępnych biletów", class: "label" %>
    <div class="control">
      <%= form.number_field :available_tickets,
                           class: "input #{'is-danger' if defined?(validation_errors) && validation_errors[:available_tickets].present?}",
                           min: 1 %>
    </div>
    <% if defined?(validation_errors) && validation_errors[:available_tickets].present? %>
      <p class="help is-danger">
        <%= validation_errors[:available_tickets].map { |msg| "#{msg}" }.join(', ') %>
      </p>
    <% end %>
  </div>

  <div class="field">
    <%= form.label :price, "Cena biletu", class: "label" %>
    <div class="control">
      <%= form.number_field :price,
                           class: "input #{'is-danger' if defined?(validation_errors) && validation_errors[:price].present?}",
                           step: 0.01,
                           min: 0 %>
    </div>
    <% if defined?(validation_errors) && validation_errors[:price].present? %>
      <p class="help is-danger">
        <%= validation_errors[:price].map { |msg| "#{msg}" }.join(', ') %>
      </p>
    <% end %>
  </div>

  <div class="field">
    <%= form.label :sale_start, "Data rozpoczęcia sprzedaży", class: "label" %>
    <div class="control">
      <%= form.datetime_local_field :sale_start,
                                   class: "input #{'is-danger' if defined?(validation_errors) && validation_errors[:sale_start].present?}",
                                   value: ticket_batch.sale_start&.strftime('%Y-%m-%dT%H:%M') %>
    </div>
    <% if defined?(validation_errors) && validation_errors[:sale_start].present? %>
      <p class="help is-danger">
        <%= validation_errors[:sale_start].map { |msg| "#{msg}" }.join(', ') %>
      </p>
    <% end %>
  </div>

  <div class="field">
    <%= form.label :sale_end, "Data zakończenia sprzedaży", class: "label" %>
    <div class="control">
      <%= form.datetime_local_field :sale_end,
                                   class: "input #{'is-danger' if defined?(validation_errors) && validation_errors[:sale_end].present?}",
                                   value: ticket_batch.sale_end&.strftime('%Y-%m-%dT%H:%M') %>
    </div>
    <% if defined?(validation_errors) && validation_errors[:sale_end].present? %>
      <p class="help is-danger">
        <%= validation_errors[:sale_end].map { |msg| "#{msg}" }.join(', ') %>
      </p>
    <% end %>
  </div>

  <div class="field is-grouped">
    <%= form.submit "Zapisz", class: "button is-primary" %>
    <button type="button" class="button is-light" data-action="click->modal#close">Anuluj</button>
  </div>
<% end %>